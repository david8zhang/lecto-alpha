<html>
	<style>
		.hidden{
			visibility:hidden;
		}
		.remoteStyle {
			margin:5px;
			border: 0 solid #333;
			border-top: 15px solid #333;
			border-bottom: 15px solid #333;
			border-left: 15px solid #333;
			border-right: 15px solid #333;
		}

		li{
			margin-top: 10px;
		}

		.body{
			background-color:#B6C5D5;
		}

		#localvideo{
			visibility: hidden;
		}

		.navbar {
			box-shadow: 0 5px 5px #333;
		}

	</style>
	<head>
		<!-- Boostrap components -->
        <link href="https://bootswatch.com/flatly/bootstrap.min.css" rel="stylesheet">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="/adapter.js"></script>
		<script src="/latest.js"></script>


		<meta name="keywords" content="JavaScript, WebRTC" />
		<meta name="description" content="WebRTC codelab" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1">

		<nav class="navbar navbar-default navbar-fixed-top">
			<div class="container">
				<a href="/login" class="navbar-brand">Teach</a>
				<ul class="nav nav-pills">
					<li role="presentation"><a href="/"><b>Leave Session</b></a></li>
					<li role="presentation"><a href="#" ><b>Go Premium</b></a></li>
				</ul>
			</div>
		</nav>	
	</head>

	<body class="text-center body">
		<br>
		<br>
		<br>
		<div class="container">
			<div id='videos'>
				<video id="remoteStream" autoplay controls></video>
			</div>	
		</div>
		

		<div class="hidden" id="keyholder"><%=room%></div>
		<div class="container">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h1><%=title%></h1>
					<h3><%=subject%></h3>
				</div>
				<div class="panel-body">
					<p>The price for video/premium on this lecture is $<%=price%></p>
				</div>
			</div>
		</div>

	</body>

	<script>
		var sessID = document.getElementById("keyholder").innerHTML;
		console.log(sessID);

		var participant = new RTCMultiConnection('sample')
		var sessionDescription = {
			sessionId: sessID,
			session: {
				audio: false,
				video: false
			}
		}

		participant.onstream = function(event){
			var vidElement = document.getElementById("remoteStream");
			vidElement.volume = 0.1;
			vidElement.src = URL.createObjectURL(event.stream);

			//Gain node for context stuff
			var context = new(window.AudioContext || window.webkitAudioContext)();
			var sineWave = context.createOscillator(); 
			sineWave.type = 0; //0 is sine wave
			sineWave.connect(gainNode);
			gainNode.connect(context.destination);
			//Play sine wave
			sineWave.noteOn(0);
			gainNode.gain.value = 0.8
		}

		participant.body = document.getElementById("videos");

		participant.sdpConstraints.mandatory = {
			OfferToReceiveAudio: true,
			OfferToReceiveVideo: true 
		}

		participant.join(sessionDescription);

	</script>

</html>